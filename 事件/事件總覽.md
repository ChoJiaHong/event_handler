## 事件分類對照表

| 事件類型                   | 是否部署環境變動 | 是否有最大吞吐量紀錄 | 處理流程摘要                                                  | 典型例子                               |
|----------------------------|------------------|----------------------|--------------------------------------------------------------|----------------------------------------|
| 一般異常事件               | 否               | 不適用               | 壓力測試→記錄最大吞吐量→重新分配頻率                         | 延遲升高、queue 堆積、系統空轉         |
| 部署環境變動（已有紀錄）   | 是               | 有                   | 直接查表→重新分配頻率，無需壓力測試                           | 已部署過相同配置的機器/升級            |
| 部署環境變動（無紀錄）     | 是               | 無                   | 壓力測試→記錄最大吞吐量→重新分配頻率                         | 新硬體、新組合、重大變更後首次部署     |

# 頻率調整事件處理流程

本文件分別說明三種事件對應的頻率調整流程：

1. **一般異常事件**（如延遲、queue堆積）：進行壓力測試直到測得最大吞吐量，據以調整頻率。
2. **部署環境變動（已有最大吞吐量紀錄）**：直接查詢既有紀錄調整頻率，無需壓力測試。
3. **部署環境變動（無最大吞吐量紀錄）**：進行壓力測試並紀錄新環境的最大吞吐量，再調整頻率。

---

## 1. 一般異常事件（非部署環境變動）
當系統偵測到異常事件（非部署環境變動）時，需進行以下處理流程：

#### 處理流程

1. **進行壓力測試**
   針對受影響服務進行壓力測試，以觀察系統是否已達最大吞吐量。

2. **檢查是否已達最大吞吐量**
   若尚未達最大吞吐量，持續進行壓力測試，直到達到最大吞吐量為止。

3. **記錄最大吞吐量**
   將此次壓力測試得到的最大吞吐量記錄下來，供後續調整參考。

4. **重新分配請求頻率**
   依據最大吞吐量，合理分配各 Agent 或用戶端的請求頻率。

5. **回到穩定狀態**
   確認系統回歸最佳吞吐運作狀態，繼續穩定運行。

## 2. 部署環境變動

當系統偵測到部署環境發生變化時，需進行以下處理流程：

#### 處理流程

1. **檢查是否已有此部署環境的吞吐量紀錄**
   若已有紀錄，直接進行 Step 3。否則進入 Step 2。

2. **執行方法測量最大吞吐量**
   對可能受影響的服務測量最大吞吐量，記錄此部署環境下的最大吞吐量。

3. **重新分配請求頻率**
   根據測得的最大吞吐量，合理分配各 Agent 或用戶端的請求頻率。

4. **回到穩定狀態**
   確認系統處於最佳吞吐運作區間，恢復穩定運行狀態。




